{% extends 'componentes/externo/base.html' %}
{% load static %}

{% block content %}
<section class="page-section bg-light" id="portfolio">
    {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    <div class="container">
        <div class="text-center">
            <h2 class="section-heading text-uppercase">{{ catalogo.nome }}</h2>
            <h4 class="section-subheading">
                <a href="{% url 'empresa:perfil_empresa' catalogo.empresa.pk %}" class="link-dark text-decoration-none">
                    Por: {{ catalogo.empresa.nome }}
                </a>
            </h4>
            <h3 class="section-subheading text-muted">{{ catalogo.descricao|default:"Conheça os produtos deste catálogo." }}</h3>
        </div>
        <div class="row">

            {% if is_owner %}
            <div class="col-lg-4 col-sm-6 mb-4">
                <a class="portfolio-link" href="{% url 'catalogo:adicionar_produto_catalogo' catalogo.pk %}">
                    <div class="portfolio-item add-product-card">
                        <div class="add-product-content">
                            <i class="fas fa-plus fa-3x"></i>
                            <h4 class="mt-3">Adicionar Produto</h4>
                        </div>
                    </div>
                </a>
            </div>
            {% endif %}

            {% for cp in catalogo_produtos %}
            <div class="col-lg-4 col-sm-6 mb-4">
                <div class="portfolio-item">
                    <a class="portfolio-link" data-bs-toggle="modal" href="#produtoModal{{ cp.produto.pk }}">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content"><i class="fas fa-plus fa-3x"></i></div>
                        </div>
                        {% if cp.produto.IMG %}
                            <img class="img-fluid product-image-grid" src="data:image/jpeg;base64,{{ cp.produto.get_image_base64 }}" alt="{{ cp.produto.nome }}" />
                        {% else %}
                             <img class="img-fluid product-image-grid" src="{% static 'images/placeholder.png' %}" alt="Sem imagem" />
                        {% endif %}
                    </a>
                    <div class="portfolio-caption">
                        <div class="portfolio-caption-heading">{{ cp.produto.nome }}</div>
                        <div class="portfolio-caption-subheading text-muted">R$ {{ cp.preco_final|floatformat:2 }}</div>
                    </div>
                    
                    {% if is_owner %}
                    <div class="owner-actions text-center mt-2">
                        <a href="{% url 'catalogo:remover_produto_catalogo' cp.pk %}" class="btn btn-sm btn-danger">Excluir</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% empty %}
                {% if not is_owner %}
                <div class="col-12 text-center">
                    <p class="text-muted fs-4 mt-5">Este catálogo ainda não possui produtos.</p>
                </div>
                {% endif %}
            {% endfor %}

        </div>
    </div>
</section>
<<<<<<< HEAD
<!-- Parte que quando clica no produto detalha-->

{% for cp in catalogo_produtos %}
<div class="portfolio-modal modal fade" id="produtoModal{{ cp.produto.pk }}" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="close-modal" data-bs-dismiss="modal"><img src="{% static 'página_inicial/assets/img/close-icon.svg' %}" alt="Close modal" /></div>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="modal-body">
                            <h2 class="text-uppercase">{{ cp.produto.nome }}</h2>
                            <p class="item-intro text-muted">{{ catalogo.empresa.nome }}</p>
                            
                            {% if cp.produto.IMG %}
                                <img class="img-fluid product-image-modal" src="data:image/jpeg;base64,{{ cp.produto.get_image_base64 }}" alt="{{ cp.produto.nome }}" />
                            {% endif %}
                            
                            <p class="mt-4">{{ cp.produto.descricao|default:"Produto sem descrição detalhada." }}</p>
                            
                            <ul class="list-inline">
                                <li>
                                    <strong>Preço:</strong>
                                    R$ {{ cp.preco_final|floatformat:2 }}
                                </li>
                                <li>
                                    <strong>Categoria:</strong>
                                    {{ cp.produto.categoria.nome|default:"Não especificada" }}
                                </li>
                            </ul>
                            
                            <button class="btn btn-primary btn-xl text-uppercase" data-bs-dismiss="modal" type="button">
                                <i class="fas fa-times me-1"></i>
                                Fechar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<style>
    .add-product-card {
        border: 2px dashed #ccc;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 295px; 
        background-color: #f8f9fa;
        position: relative;
        transition: all 0.2s ease-in-out;
    }
    .add-product-card:hover {
        border-color: #0d6efd; 
        background-color: #e9ecef;
    }
    .add-product-content {
        color: #6c757d;
        text-align: center;
    }
    .portfolio-item .owner-actions {
        padding-bottom: 1.5rem;
    }


    .product-image-grid {
        width: 100%;     
        height: 220px;    
        object-fit: cover; 
    }

    .product-image-modal {
        max-width: 100%;      
        max-height: 400px;   
        display: block;       
        margin: 0 auto;      
        object-fit: contain; 
    }

</style>

{% endblock %}
