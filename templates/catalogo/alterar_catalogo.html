{% extends 'componentes/interno/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="content-wrapper">
    <div class="col-md-8 grid-margin stretch-card mx-auto">
        <div class="card">
            <div class="card-body">
                <h3 class="card-title">Alterar Catálogo</h3>
                <p class="card-description">Modifique as informações do catálogo
                    "{{ catalogo.nome }}".</p>

                <form class="forms-sample" method="POST"
                    enctype="multipart/form-data">
                    {% csrf_token %}

                    <div id="thumbnail-container"
                        class="form-group d-flex flex-column align-items-center">
                        <label class="font-weight-bold d-block">Thumbnail do
                            Catálogo</label>

                        <img id="thumbnail-preview"
                            src="data:image/jpeg;base64,{{ catalogo.get_image_base64 }}"
                            style="display: block;"
                            alt="Prévia da imagem" class="mb-3">

                        <i id="icon-placeholder" class="mdi mdi-image-area"
                            style="font-size: 100px; color: #444; display: none;"></i>
                    </div>

                    <div style="display: none;">
                        {{ form.IMG }}
                    </div>

                    {{ form.nome|as_crispy_field }}
                    {{ form.descricao|as_crispy_field }}
                    {{ form.empresa|as_crispy_field }}
                    {{ form.categoria|as_crispy_field }}

                    <div class="text-center mt-4">
                        <button type="submit"
                            class="btn btn-primary mr-2">Salvar
                            Alterações</button>
                        <a href="{% url 'catalogo:visualizar_catalogos' %}"
                            class="btn btn-dark">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    #thumbnail-preview {
        width: 180px;
        height: 180px;
        object-fit: cover;
        border-radius: 15px;
        border: 2px solid #444;
        background-color: #2A3038;
    }
    #thumbnail-container {
        cursor: pointer;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('id_IMG');
    const imagePreview = document.getElementById('thumbnail-preview');
    const iconPlaceholder = document.getElementById('icon-placeholder');
    const thumbnailContainer = document.getElementById('thumbnail-container');

    // MUDANÇA 6: Adicionamos o evento de clique na ÁREA da prévia
    if (thumbnailContainer) {
        thumbnailContainer.addEventListener('click', function() {
            fileInput.click();
        });
    }

    if(fileInput) {
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    if (iconPlaceholder) iconPlaceholder.style.display = 'none';
                };
                reader.readDataURL(file);
            }
        });
    }
});
</script>
{% endblock %}